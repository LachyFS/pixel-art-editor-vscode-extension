{
  "version": 3,
  "sources": ["../../src/extension/extension.ts", "../../src/extension/PixelArtEditorProvider.ts"],
  "sourcesContent": ["import * as vscode from 'vscode';\nimport { PixelArtEditorProvider } from './PixelArtEditorProvider';\n\nexport function activate(context: vscode.ExtensionContext) {\n  const provider = new PixelArtEditorProvider(context);\n\n  const providerRegistration = vscode.window.registerCustomEditorProvider(\n    PixelArtEditorProvider.viewType,\n    provider,\n    {\n      webviewOptions: {\n        retainContextWhenHidden: true,\n      },\n      supportsMultipleEditorsPerDocument: false,\n    }\n  );\n\n  const openEditorCommand = vscode.commands.registerCommand(\n    'pixelArtEditor.openEditor',\n    (uri?: vscode.Uri) => {\n      const targetUri = uri ?? vscode.window.activeTextEditor?.document.uri;\n      if (targetUri) {\n        vscode.commands.executeCommand(\n          'vscode.openWith',\n          targetUri,\n          PixelArtEditorProvider.viewType\n        );\n      }\n    }\n  );\n\n  context.subscriptions.push(providerRegistration, openEditorCommand);\n}\n\nexport function deactivate() {}\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\n\ninterface PixelArtEdit {\n  readonly type: 'pixel' | 'fill' | 'clear';\n  readonly data: Uint8Array;\n}\n\nclass PixelArtDocument implements vscode.CustomDocument {\n  private readonly _uri: vscode.Uri;\n  private _imageData: Uint8Array;\n  private _edits: PixelArtEdit[] = [];\n  private _savedEdits: PixelArtEdit[] = [];\n\n  private readonly _onDidDispose = new vscode.EventEmitter<void>();\n  public readonly onDidDispose = this._onDidDispose.event;\n\n  private readonly _onDidChangeDocument = new vscode.EventEmitter<{\n    readonly edits: readonly PixelArtEdit[];\n    readonly undo: readonly PixelArtEdit[];\n    readonly redo: readonly PixelArtEdit[];\n  }>();\n  public readonly onDidChangeContent = this._onDidChangeDocument.event;\n\n  static async create(uri: vscode.Uri): Promise<PixelArtDocument> {\n    const fileData = await vscode.workspace.fs.readFile(uri);\n    return new PixelArtDocument(uri, fileData);\n  }\n\n  private constructor(uri: vscode.Uri, initialData: Uint8Array) {\n    this._uri = uri;\n    this._imageData = initialData;\n  }\n\n  get uri(): vscode.Uri {\n    return this._uri;\n  }\n\n  get imageData(): Uint8Array {\n    return this._imageData;\n  }\n\n  set imageData(data: Uint8Array) {\n    this._imageData = data;\n  }\n\n  get edits(): readonly PixelArtEdit[] {\n    return this._edits;\n  }\n\n  makeEdit(edit: PixelArtEdit) {\n    this._edits.push(edit);\n    this._onDidChangeDocument.fire({\n      edits: this._edits,\n      undo: [],\n      redo: [],\n    });\n  }\n\n  dispose(): void {\n    this._onDidDispose.fire();\n    this._onDidDispose.dispose();\n    this._onDidChangeDocument.dispose();\n  }\n}\n\nexport class PixelArtEditorProvider implements vscode.CustomEditorProvider<PixelArtDocument> {\n  public static readonly viewType = 'pixelArtEditor.editor';\n\n  private readonly _onDidChangeCustomDocument = new vscode.EventEmitter<\n    vscode.CustomDocumentEditEvent<PixelArtDocument>\n  >();\n  public readonly onDidChangeCustomDocument = this._onDidChangeCustomDocument.event;\n\n  constructor(private readonly context: vscode.ExtensionContext) {}\n\n  async openCustomDocument(\n    uri: vscode.Uri,\n    _openContext: vscode.CustomDocumentOpenContext,\n    _token: vscode.CancellationToken\n  ): Promise<PixelArtDocument> {\n    const document = await PixelArtDocument.create(uri);\n    return document;\n  }\n\n  async resolveCustomEditor(\n    document: PixelArtDocument,\n    webviewPanel: vscode.WebviewPanel,\n    _token: vscode.CancellationToken\n  ): Promise<void> {\n    webviewPanel.webview.options = {\n      enableScripts: true,\n      localResourceRoots: [\n        vscode.Uri.joinPath(this.context.extensionUri, 'out'),\n        vscode.Uri.joinPath(this.context.extensionUri, 'dist'),\n      ],\n    };\n\n    webviewPanel.webview.html = this.getHtmlForWebview(webviewPanel.webview);\n\n    const updateWebview = () => {\n      const base64 = Buffer.from(document.imageData).toString('base64');\n      const mimeType = this.getMimeType(document.uri.fsPath);\n      webviewPanel.webview.postMessage({\n        type: 'init',\n        body: {\n          imageData: `data:${mimeType};base64,${base64}`,\n          fileName: path.basename(document.uri.fsPath),\n        },\n      });\n    };\n\n    webviewPanel.webview.onDidReceiveMessage((message) => {\n      switch (message.type) {\n        case 'ready':\n          updateWebview();\n          break;\n        case 'edit':\n          const imageData = this.base64ToUint8Array(message.body.imageData);\n          document.imageData = imageData;\n          document.makeEdit({ type: message.body.editType, data: imageData });\n          this._onDidChangeCustomDocument.fire({\n            document,\n            undo: async () => {},\n            redo: async () => {},\n          });\n          break;\n        case 'requestSave':\n          vscode.commands.executeCommand('workbench.action.files.save');\n          break;\n      }\n    });\n  }\n\n  async saveCustomDocument(\n    document: PixelArtDocument,\n    cancellation: vscode.CancellationToken\n  ): Promise<void> {\n    await vscode.workspace.fs.writeFile(document.uri, document.imageData);\n  }\n\n  async saveCustomDocumentAs(\n    document: PixelArtDocument,\n    destination: vscode.Uri,\n    cancellation: vscode.CancellationToken\n  ): Promise<void> {\n    await vscode.workspace.fs.writeFile(destination, document.imageData);\n  }\n\n  async revertCustomDocument(\n    document: PixelArtDocument,\n    cancellation: vscode.CancellationToken\n  ): Promise<void> {\n    const fileData = await vscode.workspace.fs.readFile(document.uri);\n    document.imageData = fileData;\n  }\n\n  async backupCustomDocument(\n    document: PixelArtDocument,\n    context: vscode.CustomDocumentBackupContext,\n    cancellation: vscode.CancellationToken\n  ): Promise<vscode.CustomDocumentBackup> {\n    await vscode.workspace.fs.writeFile(context.destination, document.imageData);\n    return {\n      id: context.destination.toString(),\n      delete: async () => {\n        try {\n          await vscode.workspace.fs.delete(context.destination);\n        } catch {\n          // Ignore errors\n        }\n      },\n    };\n  }\n\n  private getMimeType(filePath: string): string {\n    const ext = path.extname(filePath).toLowerCase();\n    switch (ext) {\n      case '.png':\n        return 'image/png';\n      case '.jpg':\n      case '.jpeg':\n        return 'image/jpeg';\n      case '.gif':\n        return 'image/gif';\n      case '.bmp':\n        return 'image/bmp';\n      default:\n        return 'image/png';\n    }\n  }\n\n  private base64ToUint8Array(base64: string): Uint8Array {\n    const dataUrlPrefix = /^data:[^;]+;base64,/;\n    const cleanBase64 = base64.replace(dataUrlPrefix, '');\n    const binaryString = Buffer.from(cleanBase64, 'base64');\n    return new Uint8Array(binaryString);\n  }\n\n  private getHtmlForWebview(webview: vscode.Webview): string {\n    const scriptUri = webview.asWebviewUri(\n      vscode.Uri.joinPath(this.context.extensionUri, 'dist', 'webview.js')\n    );\n    const styleUri = webview.asWebviewUri(\n      vscode.Uri.joinPath(this.context.extensionUri, 'dist', 'webview.css')\n    );\n\n    const nonce = this.getNonce();\n\n    return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src 'nonce-${nonce}'; img-src ${webview.cspSource} data: blob:;\">\n  <link href=\"${styleUri}\" rel=\"stylesheet\">\n  <title>Pixel Art Editor</title>\n</head>\n<body>\n  <div id=\"root\"></div>\n  <script nonce=\"${nonce}\" src=\"${scriptUri}\"></script>\n</body>\n</html>`;\n  }\n\n  private getNonce(): string {\n    let text = '';\n    const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    for (let i = 0; i < 32; i++) {\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n  }\n}\n"],
  "mappings": "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",
  "names": ["vscode"]
}
